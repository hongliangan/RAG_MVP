<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>RAG MVP - ç»“æœå±•ç¤º</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        .config-info {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .config-info h5 {
            color: #495057;
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body class="container py-5">
    <h1 class="mb-4">RAG MVP - ç»“æœå±•ç¤º</h1>
    <div class="mb-3">
        <strong>æ–‡ä»¶åï¼š</strong> {{ filename }}
    </div>
    <div class="mb-3">
        <strong>ä½ çš„é—®é¢˜ï¼š</strong> {{ question }}
    </div>
    <div class="mb-3">
        <strong>æœ€ç»ˆç­”æ¡ˆï¼š</strong>
        <div class="alert alert-info">{{ answer }}</div>
    </div>

    <!-- é…ç½®ä¿¡æ¯å±•ç¤º -->
    <div class="row">
        <div class="col-md-6">
            <div class="config-info">
                <h5>âœ‚ï¸ æ–‡æœ¬åˆ‡ç‰‡é…ç½®</h5>
                <ul class="list-unstyled">
                    <li><strong>åˆ‡ç‰‡æ–¹å¼ï¼š</strong>{{ chunk_config.split_method }}</li>
                    {% if chunk_config.split_method == 'character' %}
                        <li><strong>æ¯å—æœ€å¤§å­—ç¬¦æ•°ï¼š</strong>{{ chunk_config.chunk_size }}</li>
                        <li><strong>é‡å å­—ç¬¦æ•°ï¼š</strong>{{ chunk_config.chunk_overlap }}</li>
                    {% elif chunk_config.split_method == 'sentence' %}
                        <li><strong>æ¯å—æœ€å¤§å¥å­æ•°ï¼š</strong>{{ chunk_config.max_sentences_per_chunk }}</li>
                    {% elif chunk_config.split_method == 'paragraph' %}
                        <li><strong>æœ€å°æ®µè½é•¿åº¦ï¼š</strong>{{ chunk_config.min_paragraph_length }}</li>
                        <li><strong>æœ€å¤§æ®µè½é•¿åº¦ï¼š</strong>{{ chunk_config.max_paragraph_length }}</li>
                    {% endif %}
                </ul>
            </div>
        </div>
        <div class="col-md-6">
            <div class="config-info">
                <h5>ğŸ” æ£€ç´¢é…ç½®</h5>
                <ul class="list-unstyled">
                    <li><strong>è¿”å›ç‰‡æ®µæ•°ï¼š</strong>{{ retrieval_params.top_k }}</li>
                    <li><strong>ç›¸ä¼¼åº¦é˜ˆå€¼ï¼š</strong>{{ retrieval_params.similarity_threshold }}</li>
                    <li><strong>æ£€ç´¢ç­–ç•¥ï¼š</strong>{{ retrieval_params.retrieval_strategy }}</li>
                    <li><strong>ä¸Šä¸‹æ–‡çª—å£ï¼š</strong>{{ retrieval_params.context_window }}</li>
                    <li><strong>å»é‡ç­–ç•¥ï¼š</strong>{{ "å¯ç”¨" if retrieval_params.deduplication else "ç¦ç”¨" }}</li>
                    {% if retrieval_params.weight_config.length_weight %}
                        <li><strong>é•¿åº¦æƒé‡ï¼š</strong>{{ retrieval_params.weight_config.length_weight }}</li>
                    {% endif %}
                    {% if retrieval_params.weight_config.position_weight %}
                        <li><strong>ä½ç½®æƒé‡ï¼š</strong>{{ retrieval_params.weight_config.position_weight }}</li>
                    {% endif %}
                    {% if retrieval_params.weight_config.keyword_weight %}
                        <li><strong>å…³é”®è¯æƒé‡ï¼š</strong>{{ retrieval_params.weight_config.keyword_weight|join(', ') }}</li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </div>

    <div class="mb-4">
        <h4>å¤„ç†ç»“æœç»Ÿè®¡</h4>
        <ul class="mt-3">
            <li>æ–‡æ¡£åŠ è½½ï¼šå…± <strong>{{ doc_chunks|length }}</strong> æ®µ</li>
            <li>å‘é‡åŒ–ï¼šå…± <strong>{{ embeddings|length }}</strong> å‘é‡</li>
            <li>æ£€ç´¢ï¼šå…± <strong>{{ retrieved_chunks|length }}</strong> æ®µ</li>
            <li>ç”Ÿæˆï¼š<strong>{% if answer %}å·²å®Œæˆ{% else %}å¤„ç†ä¸­...{% endif %}</strong></li>
        </ul>
    </div>
    <button class="btn btn-link" type="button" data-bs-toggle="collapse" data-bs-target="#details" aria-expanded="false" aria-controls="details">
        æŸ¥çœ‹è¯¦ç»†å¤„ç†è¿‡ç¨‹
    </button>
    <div class="collapse mt-3" id="details">
        <div class="card card-body">
            <h5>1. æ–‡æ¡£åŠ è½½ï¼ˆåˆ†æ®µç»“æœï¼‰</h5>
            <ol>
                {% for chunk in doc_chunks %}
                <li><pre>{{ chunk }}</pre></li>
                {% endfor %}
            </ol>
            <h5>2. æ£€ç´¢åˆ°çš„ç›¸å…³ç‰‡æ®µ</h5>
            <ol>
                {% for chunk in retrieved_chunks %}
                <li><pre>{{ chunk }}</pre></li>
                {% endfor %}
            </ol>
        </div>
    </div>
    <a href="/" class="btn btn-secondary mt-4">è¿”å›é¦–é¡µ</a>
</body>
</html>
